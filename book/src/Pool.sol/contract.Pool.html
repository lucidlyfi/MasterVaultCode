<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pool</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../src/BalancerLibCode/index.html">❱ BalancerLibCode</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/BalancerLibCode/LogExpMath.sol/library.LogExpMath.html">LogExpMath</a></li></ol></li><li class="chapter-item "><a href="../../src/Mocks/index.html">❱ Mocks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/Mocks/MockRateProvider.sol/contract.MockRateProvider.html">MockRateProvider</a></li><li class="chapter-item "><a href="../../src/Mocks/MockToken.sol/contract.MockToken.html">MockToken</a></li></ol></li><li class="chapter-item "><a href="../../src/RateProvider/index.html">❱ RateProvider</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/RateProvider/ICurveStableSwapNG.sol/interface.ICurveStableSwapNG.html">ICurveStableSwapNG</a></li><li class="chapter-item "><a href="../../src/RateProvider/IPufEth.sol/interface.IPufEth.html">IPufEth</a></li><li class="chapter-item "><a href="../../src/RateProvider/IRateProvider.sol/interface.IRateProvider.html">IRateProvider</a></li><li class="chapter-item "><a href="../../src/RateProvider/IStEth.sol/interface.IStEth.html">IStEth</a></li><li class="chapter-item "><a href="../../src/RateProvider/PufMVTRateProvider.sol/contract.PufMVTRateProvider.html">PufMVTRateProvider</a></li><li class="chapter-item "><a href="../../src/RateProvider/RateProvider.sol/contract.RateProvider.html">RateProvider</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/Pool.sol/contract.Pool.html" class="active">Pool</a></li><li class="chapter-item "><a href="../../src/PoolToken.sol/contract.PoolToken.html">PoolToken</a></li><li class="chapter-item "><a href="../../src/Staking.sol/contract.MasterVault.html">MasterVault</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/lucidlyfi/MasterVaultCode" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pool"><a class="header" href="#pool">Pool</a></h1>
<p><a href="https://github.com/lucidlyfi/MasterVaultCode/blob/e89626c00c676e7b87a7121ad91042902a96f6d2/src/Pool.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Ownable, ReentrancyGuard</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="precision"><a class="header" href="#precision">PRECISION</a></h3>
<pre><code class="language-solidity">uint256 constant PRECISION = 1_000_000_000_000_000_000;
</code></pre>
<h3 id="max_num_tokens"><a class="header" href="#max_num_tokens">MAX_NUM_TOKENS</a></h3>
<pre><code class="language-solidity">uint256 constant MAX_NUM_TOKENS = 32;
</code></pre>
<h3 id="all_tokens_flag"><a class="header" href="#all_tokens_flag">ALL_TOKENS_FLAG</a></h3>
<pre><code class="language-solidity">uint256 constant ALL_TOKENS_FLAG =
    14_528_991_250_861_404_666_834_535_435_384_615_765_856_667_510_756_806_797_353_855_100_662_256_435_713;
</code></pre>
<h3 id="pool_vb_mask"><a class="header" href="#pool_vb_mask">POOL_VB_MASK</a></h3>
<pre><code class="language-solidity">uint256 constant POOL_VB_MASK = 2 ** 128 - 1;
</code></pre>
<h3 id="pool_vb_shift"><a class="header" href="#pool_vb_shift">POOL_VB_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant POOL_VB_SHIFT = 128;
</code></pre>
<h3 id="vb_mask"><a class="header" href="#vb_mask">VB_MASK</a></h3>
<pre><code class="language-solidity">uint256 constant VB_MASK = 2 ** 96 - 1;
</code></pre>
<h3 id="rate_mask"><a class="header" href="#rate_mask">RATE_MASK</a></h3>
<pre><code class="language-solidity">uint256 constant RATE_MASK = 2 ** 80 - 1;
</code></pre>
<h3 id="rate_shift"><a class="header" href="#rate_shift">RATE_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant RATE_SHIFT = 96;
</code></pre>
<h3 id="packed_weight_shift"><a class="header" href="#packed_weight_shift">PACKED_WEIGHT_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant PACKED_WEIGHT_SHIFT = 176;
</code></pre>
<h3 id="weight_scale"><a class="header" href="#weight_scale">WEIGHT_SCALE</a></h3>
<pre><code class="language-solidity">uint256 constant WEIGHT_SCALE = 1_000_000_000_000;
</code></pre>
<h3 id="weight_mask"><a class="header" href="#weight_mask">WEIGHT_MASK</a></h3>
<pre><code class="language-solidity">uint256 constant WEIGHT_MASK = 2 ** 20 - 1;
</code></pre>
<h3 id="target_weight_shift"><a class="header" href="#target_weight_shift">TARGET_WEIGHT_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant TARGET_WEIGHT_SHIFT = 20;
</code></pre>
<h3 id="lower_band_shift"><a class="header" href="#lower_band_shift">LOWER_BAND_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant LOWER_BAND_SHIFT = 40;
</code></pre>
<h3 id="upper_band_shift"><a class="header" href="#upper_band_shift">UPPER_BAND_SHIFT</a></h3>
<pre><code class="language-solidity">uint128 constant UPPER_BAND_SHIFT = 60;
</code></pre>
<h3 id="max_pow_rel_err"><a class="header" href="#max_pow_rel_err">MAX_POW_REL_ERR</a></h3>
<pre><code class="language-solidity">uint256 constant MAX_POW_REL_ERR = 100;
</code></pre>
<h3 id="amplification"><a class="header" href="#amplification">amplification</a></h3>
<pre><code class="language-solidity">uint256 public amplification;
</code></pre>
<h3 id="numtokens"><a class="header" href="#numtokens">numTokens</a></h3>
<pre><code class="language-solidity">uint256 public numTokens;
</code></pre>
<h3 id="supply"><a class="header" href="#supply">supply</a></h3>
<pre><code class="language-solidity">uint256 public supply;
</code></pre>
<h3 id="tokenaddress"><a class="header" href="#tokenaddress">tokenAddress</a></h3>
<pre><code class="language-solidity">address public tokenAddress;
</code></pre>
<h3 id="stakingaddress"><a class="header" href="#stakingaddress">stakingAddress</a></h3>
<pre><code class="language-solidity">address public stakingAddress;
</code></pre>
<h3 id="tokens"><a class="header" href="#tokens">tokens</a></h3>
<pre><code class="language-solidity">address[MAX_NUM_TOKENS] public tokens;
</code></pre>
<h3 id="rateproviders"><a class="header" href="#rateproviders">rateProviders</a></h3>
<pre><code class="language-solidity">address[MAX_NUM_TOKENS] public rateProviders;
</code></pre>
<h3 id="packedvirtualbalances"><a class="header" href="#packedvirtualbalances">packedVirtualBalances</a></h3>
<pre><code class="language-solidity">uint256[MAX_NUM_TOKENS] public packedVirtualBalances;
</code></pre>
<h3 id="paused"><a class="header" href="#paused">paused</a></h3>
<pre><code class="language-solidity">bool public paused;
</code></pre>
<h3 id="killed"><a class="header" href="#killed">killed</a></h3>
<pre><code class="language-solidity">bool public killed;
</code></pre>
<h3 id="swapfeerate"><a class="header" href="#swapfeerate">swapFeeRate</a></h3>
<pre><code class="language-solidity">uint256 public swapFeeRate;
</code></pre>
<h3 id="rampstep"><a class="header" href="#rampstep">rampStep</a></h3>
<pre><code class="language-solidity">uint256 public rampStep;
</code></pre>
<h3 id="ramplasttime"><a class="header" href="#ramplasttime">rampLastTime</a></h3>
<pre><code class="language-solidity">uint256 public rampLastTime;
</code></pre>
<h3 id="rampstoptime"><a class="header" href="#rampstoptime">rampStopTime</a></h3>
<pre><code class="language-solidity">uint256 public rampStopTime;
</code></pre>
<h3 id="targetamplification"><a class="header" href="#targetamplification">targetAmplification</a></h3>
<pre><code class="language-solidity">uint256 public targetAmplification;
</code></pre>
<h3 id="packedpoolvirtualbalance"><a class="header" href="#packedpoolvirtualbalance">packedPoolVirtualBalance</a></h3>
<pre><code class="language-solidity">uint256 packedPoolVirtualBalance;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>constructor</p>
<p><em>sum of all weights</em></p>
<p><em>rebasing tokens not supported</em></p>
<pre><code class="language-solidity">constructor(
    address tokenAddress_,
    uint256 amplification_,
    address[] memory tokens_,
    address[] memory rateProviders_,
    uint256[] memory weights_,
    address owner_
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>tokenAddress_</code></td><td><code>address</code></td><td>address of the poolToken</td></tr>
<tr><td><code>amplification_</code></td><td><code>uint256</code></td><td>the pool amplification factor (in 18 decimals)</td></tr>
<tr><td><code>tokens_</code></td><td><code>address[]</code></td><td>array of addresses of tokens in the pool</td></tr>
<tr><td><code>rateProviders_</code></td><td><code>address[]</code></td><td>array of addresses of rate providers for the tokens in the pool</td></tr>
<tr><td><code>weights_</code></td><td><code>uint256[]</code></td><td>weight of each token (in 18 decimals)</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="swap"><a class="header" href="#swap">swap</a></h3>
<p>swap one pool token for another</p>
<pre><code class="language-solidity">function swap(
    uint256 tokenIn_,
    uint256 tokenOut_,
    uint256 tokenInAmount_,
    uint256 minTokenOutAmount_,
    address receiver_
) external nonReentrant returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>tokenIn_</code></td><td><code>uint256</code></td><td>index of the input token</td></tr>
<tr><td><code>tokenOut_</code></td><td><code>uint256</code></td><td>index of the output token</td></tr>
<tr><td><code>tokenInAmount_</code></td><td><code>uint256</code></td><td>amount of input token to take from the caller</td></tr>
<tr><td><code>minTokenOutAmount_</code></td><td><code>uint256</code></td><td>minimum amount of output token to send</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>account to receive the output token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the amount of output token</td></tr>
</tbody></table>
</div>
<h3 id="addliquidity"><a class="header" href="#addliquidity">addLiquidity</a></h3>
<p>deposit tokens into the pool</p>
<pre><code class="language-solidity">function addLiquidity(uint256[] calldata amounts_, uint256 minLpAmount_, address receiver_)
    external
    nonReentrant
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amounts_</code></td><td><code>uint256[]</code></td><td>array of the amount for each token to take from caller</td></tr>
<tr><td><code>minLpAmount_</code></td><td><code>uint256</code></td><td>minimum amount of lp tokens to mint</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>account to receive the lp tokens</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>amount of LP tokens minted</td></tr>
</tbody></table>
</div>
<h3 id="removeliquidity"><a class="header" href="#removeliquidity">removeLiquidity</a></h3>
<p>withdraw tokens from the pool in a balanced manner</p>
<pre><code class="language-solidity">function removeLiquidity(uint256 lpAmount_, uint256[] calldata minAmounts_, address receiver_) external nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>lpAmount_</code></td><td><code>uint256</code></td><td>amount of lp tokens to burn</td></tr>
<tr><td><code>minAmounts_</code></td><td><code>uint256[]</code></td><td>array of minimum amount of each token to send</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>account to receive the tokens</td></tr>
</tbody></table>
</div>
<h3 id="removeliquiditysingle"><a class="header" href="#removeliquiditysingle">removeLiquiditySingle</a></h3>
<p>withdraw a single token from the pool</p>
<pre><code class="language-solidity">function removeLiquiditySingle(uint256 token_, uint256 lpAmount_, uint256 minTokenOutAmount_, address receiver_)
    external
    nonReentrant
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token to withdraw</td></tr>
<tr><td><code>lpAmount_</code></td><td><code>uint256</code></td><td>amount of lp tokens to burn</td></tr>
<tr><td><code>minTokenOutAmount_</code></td><td><code>uint256</code></td><td>minimum amount of tokens to send</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>account to receive the token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the amount of the token sent</td></tr>
</tbody></table>
</div>
<h3 id="updaterates"><a class="header" href="#updaterates">updateRates</a></h3>
<p>update the stored rate of any of the pool's tokens</p>
<p><em>if no assets are passed in, every asset will be updated</em></p>
<pre><code class="language-solidity">function updateRates(uint256[] calldata tokens_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>tokens_</code></td><td><code>uint256[]</code></td><td>array of indices of tokens to update</td></tr>
</tbody></table>
</div>
<h3 id="updateweights"><a class="header" href="#updateweights">updateWeights</a></h3>
<p>update weights and amplification factor, if possible</p>
<p><em>will only update the weights if a ramp is active and at least the minimum time step has been reached</em></p>
<pre><code class="language-solidity">function updateWeights() external returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>boolean to indicate whether the weights and amplification factor have been updated</td></tr>
</tbody></table>
</div>
<h3 id="virtualbalanceprodsum"><a class="header" href="#virtualbalanceprodsum">virtualBalanceProdSum</a></h3>
<p>get the pool's virtual balance product (pi) and sum (sigma)</p>
<pre><code class="language-solidity">function virtualBalanceProdSum() external view returns (uint256, uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with product and sum</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="virtualbalance"><a class="header" href="#virtualbalance">virtualBalance</a></h3>
<p>get the virtual balance of a token</p>
<pre><code class="language-solidity">function virtualBalance(uint256 token_) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token in the pool</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>virtual balance of the token</td></tr>
</tbody></table>
</div>
<h3 id="rate"><a class="header" href="#rate">rate</a></h3>
<p>get the rate of an token</p>
<pre><code class="language-solidity">function rate(uint256 token_) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>rate of the token</td></tr>
</tbody></table>
</div>
<h3 id="weight"><a class="header" href="#weight">weight</a></h3>
<p>get the weight of a token</p>
<p><em>does not take into account any active ramp</em></p>
<pre><code class="language-solidity">function weight(uint256 token_) external view returns (uint256, uint256, uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with weight, target weight, lower band width, upper weight band width</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="packedweight"><a class="header" href="#packedweight">packedWeight</a></h3>
<p>get the packed weight of a token in a packed format</p>
<p><em>does not take into account any active ramp</em></p>
<pre><code class="language-solidity">function packedWeight(uint256 token_) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>weight in packed format</td></tr>
</tbody></table>
</div>
<h3 id="pause"><a class="header" href="#pause">pause</a></h3>
<p>pause the pool</p>
<pre><code class="language-solidity">function pause() external onlyOwner;
</code></pre>
<h3 id="unpause"><a class="header" href="#unpause">unpause</a></h3>
<p>unpause the pool</p>
<pre><code class="language-solidity">function unpause() external onlyOwner;
</code></pre>
<h3 id="kill"><a class="header" href="#kill">kill</a></h3>
<p>kill the pool</p>
<pre><code class="language-solidity">function kill() external onlyOwner;
</code></pre>
<h3 id="addtoken"><a class="header" href="#addtoken">addToken</a></h3>
<p>add a new token to the pool</p>
<p><em>can only be called if no ramp is currently active</em></p>
<p><em>every other token will their weight reduced pro rata</em></p>
<p><em>caller should assure that amplification before and after the call are the same</em></p>
<pre><code class="language-solidity">function addToken(
    address token_,
    address rateProvider_,
    uint256 weight_,
    uint256 lower_,
    uint256 upper_,
    uint256 amount_,
    uint256 amplification_,
    uint256 minLpAmount_,
    address receiver_
) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>address</code></td><td>address of the token to add</td></tr>
<tr><td><code>rateProvider_</code></td><td><code>address</code></td><td>rate provider for the token</td></tr>
<tr><td><code>weight_</code></td><td><code>uint256</code></td><td>weight of the new token</td></tr>
<tr><td><code>lower_</code></td><td><code>uint256</code></td><td>lower band width</td></tr>
<tr><td><code>upper_</code></td><td><code>uint256</code></td><td>upper band width</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>amount of tokens</td></tr>
<tr><td><code>amplification_</code></td><td><code>uint256</code></td><td>new pool amplification factor</td></tr>
<tr><td><code>minLpAmount_</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>account to receive the lp tokens minted</td></tr>
</tbody></table>
</div>
<h3 id="rescue"><a class="header" href="#rescue">rescue</a></h3>
<p>rescue tokens from this contract</p>
<p><em>cannot be used to rescue pool tokens</em></p>
<pre><code class="language-solidity">function rescue(address token_, address receiver_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>address</code></td><td>the token to be rescued</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>receiver of the rescued tokens</td></tr>
</tbody></table>
</div>
<h3 id="skim"><a class="header" href="#skim">skim</a></h3>
<p>skim surplus of a pool token</p>
<pre><code class="language-solidity">function skim(uint256 token_, address receiver_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token</td></tr>
<tr><td><code>receiver_</code></td><td><code>address</code></td><td>receiver of the skimmed tokens</td></tr>
</tbody></table>
</div>
<h3 id="setswapfeerate"><a class="header" href="#setswapfeerate">setSwapFeeRate</a></h3>
<p>set new swap fee rate</p>
<pre><code class="language-solidity">function setSwapFeeRate(uint256 feeRate_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>feeRate_</code></td><td><code>uint256</code></td><td>new swap fee rate (in 18 decimals)</td></tr>
</tbody></table>
</div>
<h3 id="setweightbands"><a class="header" href="#setweightbands">setWeightBands</a></h3>
<p>set safeft weight bands, if any user operation puts the weight outside of the bands, the transaction will revert</p>
<pre><code class="language-solidity">function setWeightBands(uint256[] calldata tokens_, uint256[] calldata lower_, uint256[] calldata upper_)
    external
    onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>tokens_</code></td><td><code>uint256[]</code></td><td>array of indices of the tokens to set the bands for</td></tr>
<tr><td><code>lower_</code></td><td><code>uint256[]</code></td><td>array of widths of the lower band</td></tr>
<tr><td><code>upper_</code></td><td><code>uint256[]</code></td><td>array of widths of the upper band</td></tr>
</tbody></table>
</div>
<h3 id="setrateprovider"><a class="header" href="#setrateprovider">setRateProvider</a></h3>
<p>set a rate provider for a token</p>
<pre><code class="language-solidity">function setRateProvider(uint256 token_, address rateProvider_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token_</code></td><td><code>uint256</code></td><td>index of the token</td></tr>
<tr><td><code>rateProvider_</code></td><td><code>address</code></td><td>new rate provider for the token</td></tr>
</tbody></table>
</div>
<h3 id="setramp"><a class="header" href="#setramp">setRamp</a></h3>
<p>schedule an amplification and/or weight change</p>
<p><em>effective amplification at any time is <code>amplification/f^n</code></em></p>
<pre><code class="language-solidity">function setRamp(uint256 amplification_, uint256[] calldata weights_, uint256 duration_, uint256 start_)
    external
    onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amplification_</code></td><td><code>uint256</code></td><td>new amplification factor (in 18 decimals)</td></tr>
<tr><td><code>weights_</code></td><td><code>uint256[]</code></td><td>array of the new weight for each token (in 18 decimals)</td></tr>
<tr><td><code>duration_</code></td><td><code>uint256</code></td><td>duration of the ramp (in seconds)</td></tr>
<tr><td><code>start_</code></td><td><code>uint256</code></td><td>ramp start time</td></tr>
</tbody></table>
</div>
<h3 id="setrampstep"><a class="header" href="#setrampstep">setRampStep</a></h3>
<p>set the minimum time b/w ramp step</p>
<pre><code class="language-solidity">function setRampStep(uint256 rampStep_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rampStep_</code></td><td><code>uint256</code></td><td>minimum step time (in seconds)</td></tr>
</tbody></table>
</div>
<h3 id="stopramp"><a class="header" href="#stopramp">stopRamp</a></h3>
<p>stop an active ramp</p>
<pre><code class="language-solidity">function stopRamp() external onlyOwner;
</code></pre>
<h3 id="setstaking"><a class="header" href="#setstaking">setStaking</a></h3>
<p>set the address that receives yield, slashings and swap fees</p>
<pre><code class="language-solidity">function setStaking(address stakingAddress_) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stakingAddress_</code></td><td><code>address</code></td><td>new staking address</td></tr>
</tbody></table>
</div>
<h3 id="_updaterates"><a class="header" href="#_updaterates">_updateRates</a></h3>
<p>update rates of specific tokens</p>
<p><em>loops through the bytes in <code>token_</code> until a zero or a number larger than the number of assets is encountered</em></p>
<p><em>update weights (if needed) prior to checking any rates</em></p>
<p><em>will recalculate supply and mint/burn to staking contract if any weight or rate has updated</em></p>
<p><em>will revert if any rate increases by more than 10%, unless called by management</em></p>
<pre><code class="language-solidity">function _updateRates(uint256 tokens_, uint256 virtualBalanceProd_, uint256 virtualBalanceSum_)
    internal
    returns (uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>tokens_</code></td><td><code>uint256</code></td><td>integer where each byte represents a token index offset by one</td></tr>
<tr><td><code>virtualBalanceProd_</code></td><td><code>uint256</code></td><td>product term (pi) before update</td></tr>
<tr><td><code>virtualBalanceSum_</code></td><td><code>uint256</code></td><td>sum term (sigma) before update</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with new product and sum term</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_updateweights"><a class="header" href="#_updateweights">_updateWeights</a></h3>
<p>apply a step in amplitude and weight ramp, if applicable</p>
<p><em>caller is reponsible for updating supply if a step has been taken</em></p>
<pre><code class="language-solidity">function _updateWeights(uint256 vbProd_) internal returns (uint256, bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vbProd_</code></td><td><code>uint256</code></td><td>product term(pi) before update</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with new product term and flag indicating if a step has been taken</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_updatesupply"><a class="header" href="#_updatesupply">_updateSupply</a></h3>
<p>calculate supply and burn or mint difference from the staking contract</p>
<pre><code class="language-solidity">function _updateSupply(uint256 supply_, uint256 vbProd_, uint256 vbSum_) internal returns (uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>supply_</code></td><td><code>uint256</code></td><td>previous supply</td></tr>
<tr><td><code>vbProd_</code></td><td><code>uint256</code></td><td>product term (pi)</td></tr>
<tr><td><code>vbSum_</code></td><td><code>uint256</code></td><td>sum term (sigma)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with new supply and product term</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_checkbands"><a class="header" href="#_checkbands">_checkBands</a></h3>
<p>check whether asset is within safety band, or if previously outside, moves closer to it</p>
<p><em>reverts if conditions are not met</em></p>
<pre><code class="language-solidity">function _checkBands(uint256 prevRatio_, uint256 ratio_, uint256 packedWeight_) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>prevRatio_</code></td><td><code>uint256</code></td><td>token ratio before user action</td></tr>
<tr><td><code>ratio_</code></td><td><code>uint256</code></td><td>token ratio after user action</td></tr>
<tr><td><code>packedWeight_</code></td><td><code>uint256</code></td><td>packed weight</td></tr>
</tbody></table>
</div>
<h3 id="_calculatevirtualbalanceprodsum"><a class="header" href="#_calculatevirtualbalanceprodsum">_calculateVirtualBalanceProdSum</a></h3>
<p>calculate product term (pi) and sum term (sigma)</p>
<pre><code class="language-solidity">function _calculateVirtualBalanceProdSum() internal view returns (uint256, uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with product and sum term</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_calculatevirtualbalanceprod"><a class="header" href="#_calculatevirtualbalanceprod">_calculateVirtualBalanceProd</a></h3>
<p>calculate product term (pi)</p>
<pre><code class="language-solidity">function _calculateVirtualBalanceProd(uint256 supply_) internal view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>supply_</code></td><td><code>uint256</code></td><td>supply to use in product term</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>product term</td></tr>
</tbody></table>
</div>
<h3 id="_calculatesupply"><a class="header" href="#_calculatesupply">_calculateSupply</a></h3>
<p>calculate supply iteratively</p>
<pre><code class="language-solidity">function _calculateSupply(
    uint256 numTokens_,
    uint256 supply_,
    uint256 amplification_,
    uint256 virtualBalanceProd_,
    uint256 virtualBalanceSum_,
    bool up_
) internal pure returns (uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>numTokens_</code></td><td><code>uint256</code></td><td>number of tokens in the pool</td></tr>
<tr><td><code>supply_</code></td><td><code>uint256</code></td><td>supply as used in product term</td></tr>
<tr><td><code>amplification_</code></td><td><code>uint256</code></td><td>amplification factor (A f^n)</td></tr>
<tr><td><code>virtualBalanceProd_</code></td><td><code>uint256</code></td><td>product term (pi)</td></tr>
<tr><td><code>virtualBalanceSum_</code></td><td><code>uint256</code></td><td>sum term (sigma)</td></tr>
<tr><td><code>up_</code></td><td><code>bool</code></td><td>whether to round up</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with new supply and product term</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_calculatevirtualbalance"><a class="header" href="#_calculatevirtualbalance">_calculateVirtualBalance</a></h3>
<p>calculate a single token's virtual balance iteratively using newton's method</p>
<pre><code class="language-solidity">function _calculateVirtualBalance(
    uint256 wn_,
    uint256 y_,
    uint256 supply_,
    uint256 amplification_,
    uint256 vbProd_,
    uint256 vbSum_
) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>wn_</code></td><td><code>uint256</code></td><td>token weight times number of tokens</td></tr>
<tr><td><code>y_</code></td><td><code>uint256</code></td><td>starting value</td></tr>
<tr><td><code>supply_</code></td><td><code>uint256</code></td><td>supply</td></tr>
<tr><td><code>amplification_</code></td><td><code>uint256</code></td><td>amplification factor <code>A f^n</code></td></tr>
<tr><td><code>vbProd_</code></td><td><code>uint256</code></td><td>intermediary product term (pi~), pi with previous balances factored out and new balance factored in</td></tr>
<tr><td><code>vbSum_</code></td><td><code>uint256</code></td><td>intermediary sum term (sigma~), sigma with previous balances subtracted and new balance added</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>new token virtual balance</td></tr>
</tbody></table>
</div>
<h3 id="_packvirtualbalance"><a class="header" href="#_packvirtualbalance">_packVirtualBalance</a></h3>
<p>pack virtual balance of a token along with other related variables</p>
<pre><code class="language-solidity">function _packVirtualBalance(uint256 virtualBalance_, uint256 rate_, uint256 packedWeight_)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>virtualBalance_</code></td><td><code>uint256</code></td><td>virtual balance of a token</td></tr>
<tr><td><code>rate_</code></td><td><code>uint256</code></td><td>token rate</td></tr>
<tr><td><code>packedWeight_</code></td><td><code>uint256</code></td><td>packed weight of a token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>packed variable</td></tr>
</tbody></table>
</div>
<h3 id="_unpackvirtualbalance"><a class="header" href="#_unpackvirtualbalance">_unpackVirtualBalance</a></h3>
<p>unpack variable to it's components</p>
<pre><code class="language-solidity">function _unpackVirtualBalance(uint256 packed_) internal pure returns (uint256, uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>packed_</code></td><td><code>uint256</code></td><td>packed variable</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with virtual balance, rate and packed weight</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_packweight"><a class="header" href="#_packweight">_packWeight</a></h3>
<p>pack weight with target and bands</p>
<pre><code class="language-solidity">function _packWeight(uint256 weight_, uint256 target_, uint256 lower_, uint256 upper_)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>weight_</code></td><td><code>uint256</code></td><td>weight with 18 decimals</td></tr>
<tr><td><code>target_</code></td><td><code>uint256</code></td><td>target weight with 18 decimals</td></tr>
<tr><td><code>lower_</code></td><td><code>uint256</code></td><td>lower band with 18 decimals, allowed distance from weight in negative direction</td></tr>
<tr><td><code>upper_</code></td><td><code>uint256</code></td><td>upper band with 18 decimal, allowed distance  from weight in positive direction</td></tr>
</tbody></table>
</div>
<h3 id="_unpackweight"><a class="header" href="#_unpackweight">_unpackWeight</a></h3>
<p>unpack weight to its components</p>
<pre><code class="language-solidity">function _unpackWeight(uint256 packed_) internal pure returns (uint256, uint256, uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>packed_</code></td><td><code>uint256</code></td><td>packed weight</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with weight, target weight, lower band and upper band (all in 18 decimals)</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_unpackweighttimesn"><a class="header" href="#_unpackweighttimesn">_unpackWeightTimesN</a></h3>
<p>unpack weight and multiply by number of tokens</p>
<pre><code class="language-solidity">function _unpackWeightTimesN(uint256 packed_, uint256 numTokens_) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>packed_</code></td><td><code>uint256</code></td><td>packed weight</td></tr>
<tr><td><code>numTokens_</code></td><td><code>uint256</code></td><td>number of tokens</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>weight multiplied by number of tokens (18 decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_packpoolvirtualbalance"><a class="header" href="#_packpoolvirtualbalance">_packPoolVirtualBalance</a></h3>
<p>pack pool product and sum term</p>
<pre><code class="language-solidity">function _packPoolVirtualBalance(uint256 prod_, uint256 sum_) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>prod_</code></td><td><code>uint256</code></td><td>Product term (pi)</td></tr>
<tr><td><code>sum_</code></td><td><code>uint256</code></td><td>Sum term (sigma)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>packed term</td></tr>
</tbody></table>
</div>
<h3 id="_unpackpoolvirtualbalance"><a class="header" href="#_unpackpoolvirtualbalance">_unpackPoolVirtualBalance</a></h3>
<p>unpack pool product and sum term</p>
<pre><code class="language-solidity">function _unpackPoolVirtualBalance(uint256 packed_) internal pure returns (uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>packed_</code></td><td><code>uint256</code></td><td>packed terms</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>tuple with pool product term (pi) and pool sum term (sigma)</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_checkifpaused"><a class="header" href="#_checkifpaused">_checkIfPaused</a></h3>
<pre><code class="language-solidity">function _checkIfPaused() internal view;
</code></pre>
<h3 id="_powup"><a class="header" href="#_powup">_powUp</a></h3>
<pre><code class="language-solidity">function _powUp(uint256 x, uint256 y) internal pure returns (uint256);
</code></pre>
<h3 id="_powdown"><a class="header" href="#_powdown">_powDown</a></h3>
<pre><code class="language-solidity">function _powDown(uint256 x, uint256 y) internal pure returns (uint256);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="swap-1"><a class="header" href="#swap-1">Swap</a></h3>
<pre><code class="language-solidity">event Swap(
    address indexed caller, address receiver, uint256 tokenIn, uint256 tokenOut, uint256 amountIn, uint256 amountOut
);
</code></pre>
<h3 id="addliquidity-1"><a class="header" href="#addliquidity-1">AddLiquidity</a></h3>
<pre><code class="language-solidity">event AddLiquidity(address indexed caller, address receiver, uint256[] amountsIn, uint256 lpAmount);
</code></pre>
<h3 id="removeliquidity-1"><a class="header" href="#removeliquidity-1">RemoveLiquidity</a></h3>
<pre><code class="language-solidity">event RemoveLiquidity(address indexed caller, address receiver, uint256 lpAmount);
</code></pre>
<h3 id="removeliquiditysingle-1"><a class="header" href="#removeliquiditysingle-1">RemoveLiquiditySingle</a></h3>
<pre><code class="language-solidity">event RemoveLiquiditySingle(
    address indexed caller, address receiver, uint256 token, uint256 amountOut, uint256 lpAmount
);
</code></pre>
<h3 id="rateupdate"><a class="header" href="#rateupdate">RateUpdate</a></h3>
<pre><code class="language-solidity">event RateUpdate(uint256 indexed token, uint256 rate);
</code></pre>
<h3 id="pause-1"><a class="header" href="#pause-1">Pause</a></h3>
<pre><code class="language-solidity">event Pause(address indexed caller);
</code></pre>
<h3 id="unpause-1"><a class="header" href="#unpause-1">Unpause</a></h3>
<pre><code class="language-solidity">event Unpause(address indexed caller);
</code></pre>
<h3 id="kill-1"><a class="header" href="#kill-1">Kill</a></h3>
<pre><code class="language-solidity">event Kill();
</code></pre>
<h3 id="addtoken-1"><a class="header" href="#addtoken-1">AddToken</a></h3>
<pre><code class="language-solidity">event AddToken(uint256 index, address token, address rateProvider, uint256 rate, uint256 weight, uint256 amount);
</code></pre>
<h3 id="setswapfeerate-1"><a class="header" href="#setswapfeerate-1">SetSwapFeeRate</a></h3>
<pre><code class="language-solidity">event SetSwapFeeRate(uint256 rate);
</code></pre>
<h3 id="setweightband"><a class="header" href="#setweightband">SetWeightBand</a></h3>
<pre><code class="language-solidity">event SetWeightBand(uint256 indexed token, uint256 lower, uint256 upper);
</code></pre>
<h3 id="setrateprovider-1"><a class="header" href="#setrateprovider-1">SetRateProvider</a></h3>
<pre><code class="language-solidity">event SetRateProvider(uint256 token, address rateProvider);
</code></pre>
<h3 id="setramp-1"><a class="header" href="#setramp-1">SetRamp</a></h3>
<pre><code class="language-solidity">event SetRamp(uint256 amplification, uint256[] weights, uint256 duration, uint256 start);
</code></pre>
<h3 id="setrampstep-1"><a class="header" href="#setrampstep-1">SetRampStep</a></h3>
<pre><code class="language-solidity">event SetRampStep(uint256 rampStep);
</code></pre>
<h3 id="stopramp-1"><a class="header" href="#stopramp-1">StopRamp</a></h3>
<pre><code class="language-solidity">event StopRamp();
</code></pre>
<h3 id="setstaking-1"><a class="header" href="#setstaking-1">SetStaking</a></h3>
<pre><code class="language-solidity">event SetStaking(address stakingAddress);
</code></pre>
<h3 id="setguardian"><a class="header" href="#setguardian">SetGuardian</a></h3>
<pre><code class="language-solidity">event SetGuardian(address indexed caller, address guardian);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="pool__inputoutputtokenssame"><a class="header" href="#pool__inputoutputtokenssame">Pool__InputOutputTokensSame</a></h3>
<pre><code class="language-solidity">error Pool__InputOutputTokensSame();
</code></pre>
<h3 id="pool__indexoutofbounds"><a class="header" href="#pool__indexoutofbounds">Pool__IndexOutOfBounds</a></h3>
<pre><code class="language-solidity">error Pool__IndexOutOfBounds();
</code></pre>
<h3 id="pool__maxlimitexceeded"><a class="header" href="#pool__maxlimitexceeded">Pool__MaxLimitExceeded</a></h3>
<pre><code class="language-solidity">error Pool__MaxLimitExceeded();
</code></pre>
<h3 id="pool__zeroamount"><a class="header" href="#pool__zeroamount">Pool__ZeroAmount</a></h3>
<pre><code class="language-solidity">error Pool__ZeroAmount();
</code></pre>
<h3 id="pool__mustbeinitiatedwithmorethanonetoken"><a class="header" href="#pool__mustbeinitiatedwithmorethanonetoken">Pool__MustBeInitiatedWithMoreThanOneToken</a></h3>
<pre><code class="language-solidity">error Pool__MustBeInitiatedWithMoreThanOneToken();
</code></pre>
<h3 id="pool__mustbeinitiatedwithagreaterthanzero"><a class="header" href="#pool__mustbeinitiatedwithagreaterthanzero">Pool__MustBeInitiatedWithAGreaterThanZero</a></h3>
<pre><code class="language-solidity">error Pool__MustBeInitiatedWithAGreaterThanZero();
</code></pre>
<h3 id="pool__invalidparams"><a class="header" href="#pool__invalidparams">Pool__InvalidParams</a></h3>
<pre><code class="language-solidity">error Pool__InvalidParams();
</code></pre>
<h3 id="pool__cannotbezeroaddress"><a class="header" href="#pool__cannotbezeroaddress">Pool__CannotBeZeroAddress</a></h3>
<pre><code class="language-solidity">error Pool__CannotBeZeroAddress();
</code></pre>
<h3 id="pool__invaliddecimals"><a class="header" href="#pool__invaliddecimals">Pool__InvalidDecimals</a></h3>
<pre><code class="language-solidity">error Pool__InvalidDecimals();
</code></pre>
<h3 id="pool__sumofweightsmustbeone"><a class="header" href="#pool__sumofweightsmustbeone">Pool__SumOfWeightsMustBeOne</a></h3>
<pre><code class="language-solidity">error Pool__SumOfWeightsMustBeOne();
</code></pre>
<h3 id="pool__invalidrateprovided"><a class="header" href="#pool__invalidrateprovided">Pool__InvalidRateProvided</a></h3>
<pre><code class="language-solidity">error Pool__InvalidRateProvided();
</code></pre>
<h3 id="pool__noconvergence"><a class="header" href="#pool__noconvergence">Pool__NoConvergence</a></h3>
<pre><code class="language-solidity">error Pool__NoConvergence();
</code></pre>
<h3 id="pool__ratiobelowlowerbound"><a class="header" href="#pool__ratiobelowlowerbound">Pool__RatioBelowLowerBound</a></h3>
<pre><code class="language-solidity">error Pool__RatioBelowLowerBound();
</code></pre>
<h3 id="pool__ratioaboveupperbound"><a class="header" href="#pool__ratioaboveupperbound">Pool__RatioAboveUpperBound</a></h3>
<pre><code class="language-solidity">error Pool__RatioAboveUpperBound();
</code></pre>
<h3 id="pool__slippagelimitexceeded"><a class="header" href="#pool__slippagelimitexceeded">Pool__SlippageLimitExceeded</a></h3>
<pre><code class="language-solidity">error Pool__SlippageLimitExceeded();
</code></pre>
<h3 id="pool__needtodepositatleastonetoken"><a class="header" href="#pool__needtodepositatleastonetoken">Pool__NeedToDepositAtleastOneToken</a></h3>
<pre><code class="language-solidity">error Pool__NeedToDepositAtleastOneToken();
</code></pre>
<h3 id="pool__initialdepositamountmustbenonzero"><a class="header" href="#pool__initialdepositamountmustbenonzero">Pool__InitialDepositAmountMustBeNonZero</a></h3>
<pre><code class="language-solidity">error Pool__InitialDepositAmountMustBeNonZero();
</code></pre>
<h3 id="pool__amountsmustbenonzero"><a class="header" href="#pool__amountsmustbenonzero">Pool__AmountsMustBeNonZero</a></h3>
<pre><code class="language-solidity">error Pool__AmountsMustBeNonZero();
</code></pre>
<h3 id="pool__weightoutofbounds"><a class="header" href="#pool__weightoutofbounds">Pool__WeightOutOfBounds</a></h3>
<pre><code class="language-solidity">error Pool__WeightOutOfBounds();
</code></pre>
<h3 id="pool__poolisfull"><a class="header" href="#pool__poolisfull">Pool__PoolIsFull</a></h3>
<pre><code class="language-solidity">error Pool__PoolIsFull();
</code></pre>
<h3 id="pool__rampactive"><a class="header" href="#pool__rampactive">Pool__RampActive</a></h3>
<pre><code class="language-solidity">error Pool__RampActive();
</code></pre>
<h3 id="pool__poolisempty"><a class="header" href="#pool__poolisempty">Pool__PoolIsEmpty</a></h3>
<pre><code class="language-solidity">error Pool__PoolIsEmpty();
</code></pre>
<h3 id="pool__tokenalreadypartofpool"><a class="header" href="#pool__tokenalreadypartofpool">Pool__TokenAlreadyPartOfPool</a></h3>
<pre><code class="language-solidity">error Pool__TokenAlreadyPartOfPool();
</code></pre>
<h3 id="pool__cannotrescuepooltoken"><a class="header" href="#pool__cannotrescuepooltoken">Pool__CannotRescuePoolToken</a></h3>
<pre><code class="language-solidity">error Pool__CannotRescuePoolToken();
</code></pre>
<h3 id="pool__bandsoutofbounds"><a class="header" href="#pool__bandsoutofbounds">Pool__BandsOutOfBounds</a></h3>
<pre><code class="language-solidity">error Pool__BandsOutOfBounds();
</code></pre>
<h3 id="pool__weightsdonotaddup"><a class="header" href="#pool__weightsdonotaddup">Pool__WeightsDoNotAddUp</a></h3>
<pre><code class="language-solidity">error Pool__WeightsDoNotAddUp();
</code></pre>
<h3 id="pool__alreadypaused"><a class="header" href="#pool__alreadypaused">Pool__AlreadyPaused</a></h3>
<pre><code class="language-solidity">error Pool__AlreadyPaused();
</code></pre>
<h3 id="pool__notpaused"><a class="header" href="#pool__notpaused">Pool__NotPaused</a></h3>
<pre><code class="language-solidity">error Pool__NotPaused();
</code></pre>
<h3 id="pool__killed"><a class="header" href="#pool__killed">Pool__Killed</a></h3>
<pre><code class="language-solidity">error Pool__Killed();
</code></pre>
<h3 id="pool__nosurplus"><a class="header" href="#pool__nosurplus">Pool__NoSurplus</a></h3>
<pre><code class="language-solidity">error Pool__NoSurplus();
</code></pre>
<h3 id="pool__norate"><a class="header" href="#pool__norate">Pool__NoRate</a></h3>
<pre><code class="language-solidity">error Pool__NoRate();
</code></pre>
<h3 id="pool__paused"><a class="header" href="#pool__paused">Pool__Paused</a></h3>
<pre><code class="language-solidity">error Pool__Paused();
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/RateProvider/RateProvider.sol/contract.RateProvider.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/PoolToken.sol/contract.PoolToken.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/RateProvider/RateProvider.sol/contract.RateProvider.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/PoolToken.sol/contract.PoolToken.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
